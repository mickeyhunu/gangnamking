<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= pageTitle %></title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles/cloudflare-challenge.css" />
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  </head>
  <body class="cf-page">
    <main class="cf-card">
      <header class="cf-card__header">
        <p class="cf-card__eyebrow">보안을 위해 확인이 필요합니다</p>
        <h1 class="cf-card__title">Cloudflare 인증</h1>
        <p class="cf-card__subtitle">
          안전한 사이트 이용을 위해 아래 인증을 완료해주세요.
        </p>
      </header>
      <% if (errorMessage) { %>
        <p class="cf-card__error" role="alert"><%= errorMessage %></p>
      <% } %>
      <form class="cf-card__form" method="POST" action="/cloudflare/verify">
        <input type="hidden" name="next" value="<%= nextPath %>" />
        <div
          class="cf-challenge"
          data-sitekey="<%= siteKey %>"
          data-callback="onTurnstileSuccess"
        ></div>
        <button class="cf-button" type="submit">인증 완료 후 계속하기</button>
      </form>
      <p class="cf-card__footer">Cloudflare Turnstile을 사용하여 스팸 및 봇을 차단합니다.</p>
    </main>
    <script>
      function onTurnstileSuccess() {
        const submitButton = document.querySelector('.cf-button');
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.textContent = '계속하기';
        }
      }

      const submitButton = document.querySelector('.cf-button');
      if (submitButton) {
        submitButton.disabled = true;
      }
    </script>
  </body>
</html>
