<%
  const fallbackAltSuffix = (t.shop && t.shop.galleryAltFallback) || '분위기';
  const fallbackAltText = shop.imageAlt || `${shop.name} ${fallbackAltSuffix}`;
  const galleryImages = Array.isArray(shop.gallery) && shop.gallery.length
    ? shop.gallery
    : (shop.image
        ? [{ src: shop.image, alt: fallbackAltText }]
        : []);
%>
<%- include('partials/head', { title: pageTitle, description: metaDescription, seoKeywords }) %>
  <section class="detail-hero">
    <div class="container detail-hero__grid">
      <div
        class="detail-gallery"
        data-slider
        data-dot-label="<%= t.shop && t.shop.gallery ? t.shop.gallery.dotLabel : 'View image {{index}}' %>"
      >
        <div class="detail-gallery__track" data-slider-track>
          <% galleryImages.forEach(function(image) {
               const source = typeof image === 'string' ? image : image.src;
               const altText = typeof image === 'string'
                 ? `${shop.name} ${fallbackAltSuffix}`
                 : (image.alt || `${shop.name} ${fallbackAltSuffix}`);
          %>
            <figure class="detail-gallery__slide">
              <img src="<%= source %>" alt="<%= altText %>" />
            </figure>
          <% }) %>
        </div>
        <% if (galleryImages.length > 1) { %>
          <button
            class="detail-gallery__control detail-gallery__control--prev"
            type="button"
            aria-label="<%= t.shop && t.shop.gallery ? t.shop.gallery.prev : 'Previous image' %>"
            data-slider-prev
          ></button>
          <button
            class="detail-gallery__control detail-gallery__control--next"
            type="button"
            aria-label="<%= t.shop && t.shop.gallery ? t.shop.gallery.next : 'Next image' %>"
            data-slider-next
          ></button>
          <div class="detail-gallery__dots" data-slider-dots></div>
        <% } %>
      </div>
      <div class="detail-hero__info">
        <p class="detail-hero__meta"><%= shop.region %> · <%= shop.district %> · <%= shop.category %></p>
        <h1><%= shop.name %></h1>
        <% const defaultServices = ['강남권 픽업 서비스', '발렛파킹 서비스']; %>
        <% const serviceBadges = Array.isArray(t.shop && t.shop.services) && (t.shop.services.length ? t.shop.services : defaultServices) || defaultServices; %>
        <% if (serviceBadges.length) { %>
          <div class="detail-hero__services">
            <% serviceBadges.forEach(function(service) { %>
              <span class="detail-hero__service"><%= service %></span>
            <% }) %>
          </div>
        <% } %>
        <dl class="detail-hero__list">
          <div>
            <dt><%= t.shop && t.shop.address ? t.shop.address : 'Address' %></dt>
            <dd><%= shop.address %></dd>
          </div>
          <div>
            <dt><%= t.shop && t.shop.hours ? t.shop.hours : 'Hours' %></dt>
            <dd><%= shop.hours %></dd>
          </div>
        </dl>
        <div class="detail-hero__actions">
          <a class="back-link" href="/"><%= t.shop && t.shop.back ? t.shop.back : 'Back to home' %></a>
        </div>
      </div>
    </div>
  </section>

  <%
    const defaultPricingTable = [
      {
        label: '오후 9시 이전',
        meta: '주대 10 · TC 12 · RT 5',
        prices: [
          { label: '1인', amount: '27만' },
          { label: '2인', amount: '39만' },
          { label: '3인', amount: '51만' },
          { label: '4인', amount: '63만' },
        ],
      },
      {
        label: '오후 9시 이후',
        meta: '주대 13 · TC 12 · RT 5',
        prices: [
          { label: '1인', amount: '30만' },
          { label: '2인', amount: '42만' },
          { label: '3인', amount: '54만' },
          { label: '4인', amount: '67만' },
        ],
      },
    ];

    const pricingTable = Array.isArray(t.shop && t.shop.pricingTable)
      && (t.shop.pricingTable.length ? t.shop.pricingTable : defaultPricingTable)
      || defaultPricingTable;

    const pricingText = (t.shop && t.shop.pricing) || {};
    const pricingHighlight = (t.shop && t.shop.pricingHighlight) || {};
    const primaryPricing = shop.pricing || {};
    const pricingHighlightSubtitle = [shop.region, shop.district, shop.category]
      .filter(Boolean)
      .join(' · ');
    const locationSummary = [shop.region, shop.district]
      .filter(Boolean)
      .join(' · ');
    const highlightBlock = pricingTable.find(function (block) {
      return Array.isArray(block.prices) && block.prices.length;
    }) || null;
    const highlightPrice = highlightBlock ? highlightBlock.prices[0] : null;
    const perPersonNoteParts = [];

    if (highlightPrice && highlightPrice.label) {
      const perPersonContext = pricingHighlight.perPersonContext || '기준';
      perPersonNoteParts.push(`${perPersonContext} ${highlightPrice.label}`);
    }

    if (highlightBlock && highlightBlock.label) {
      perPersonNoteParts.push(highlightBlock.label);
    }

    const perPersonNote = perPersonNoteParts.join(' · ');
  %>

  <section class="pricing-highlight">
    <div class="container">
      <div class="pricing-highlight__panel">
        <div class="pricing-highlight__header">
          <span class="pricing-highlight__badge"><%= pricingHighlight.badge || '금액 안내' %></span>
          <h2 class="pricing-highlight__title"><%= shop.name %></h2>
          <% if (pricingHighlightSubtitle) { %>
            <p class="pricing-highlight__subtitle"><%= pricingHighlightSubtitle %></p>
          <% } %>
        </div>
        <div class="pricing-highlight__content">
          <div class="pricing-highlight__info">
            <div class="pricing-highlight__meta-grid">
              <% if (locationSummary) { %>
                <article class="pricing-highlight__meta-card">
                  <span class="pricing-highlight__meta-label"><%= pricingHighlight.region || '지역' %></span>
                  <strong class="pricing-highlight__meta-value"><%= locationSummary %></strong>
                </article>
              <% } %>
              <% if (shop.category) { %>
                <article class="pricing-highlight__meta-card">
                  <span class="pricing-highlight__meta-label"><%= pricingHighlight.category || '업종' %></span>
                  <strong class="pricing-highlight__meta-value"><%= shop.category %></strong>
                </article>
              <% } %>
              <article class="pricing-highlight__meta-card">
                <span class="pricing-highlight__meta-label"><%= pricingHighlight.brand || '상호' %></span>
                <strong class="pricing-highlight__meta-value"><%= shop.name %></strong>
              </article>
            </div>
            <div class="pricing-highlight__charges">
              <article class="pricing-highlight__price-card">
                <span class="pricing-highlight__price-label"><%= pricingText.base || '주대' %></span>
                <strong class="pricing-highlight__price-value"><%= primaryPricing.base || '—' %></strong>
              </article>
              <article class="pricing-highlight__price-card">
                <span class="pricing-highlight__price-label"><%= pricingText.tc || 'TC' %></span>
                <strong class="pricing-highlight__price-value"><%= primaryPricing.tc || '—' %></strong>
              </article>
              <article class="pricing-highlight__price-card">
                <span class="pricing-highlight__price-label"><%= pricingText.rt || 'RT' %></span>
                <strong class="pricing-highlight__price-value"><%= primaryPricing.rt || '—' %></strong>
              </article>
            </div>
          </div>
          <div class="pricing-highlight__per-person">
            <span class="pricing-highlight__per-person-label"><%= pricingHighlight.perPerson || '인당 가격' %></span>
            <strong class="pricing-highlight__per-person-amount"><%= (highlightPrice && highlightPrice.amount) || '—' %></strong>
            <% if (perPersonNote) { %>
              <p class="pricing-highlight__per-person-note"><%= perPersonNote %></p>
            <% } else if (pricingHighlightSubtitle) { %>
              <p class="pricing-highlight__per-person-note"><%= pricingHighlightSubtitle %></p>
            <% } %>
            <% if (highlightBlock && highlightBlock.meta) { %>
              <p class="pricing-highlight__per-person-meta"><%= highlightBlock.meta %></p>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section detail-section">
    <div class="container detail-section__grid">
      <div class="detail-card detail-card--full">
        <h2><%= t.shop && t.shop.pricing ? t.shop.pricing.title : 'Pricing' %></h2>
        <div class="rate-table">
          <% pricingTable.forEach(function(block) { %>
            <div class="rate-table__block">
              <div class="rate-table__header">
                <h3><%= block.label %></h3>
                <% if (block.meta) { %>
                  <span class="rate-table__meta"><%= block.meta %></span>
                <% } %>
              </div>
              <ul class="rate-table__list">
                <% (block.prices || []).forEach(function(item) { %>
                  <li>
                    <span class="rate-table__person"><%= item.label %></span>
                    <strong class="rate-table__amount"><%= item.amount %></strong>
                  </li>
                <% }) %>
              </ul>
            </div>
          <% }) %>
        </div>
      </div>
    </div>
  </section>

  <div class="seo-keywords" aria-hidden="true">
    <%- (seoKeywords || []).join(', ') %>
  </div>
<%- include('partials/footer', { scripts: ['/scripts/shop-detail.js'] }) %>
