<%
  const fallbackAltSuffix = (t.shop && t.shop.galleryAltFallback) || '분위기';
  const galleryImages = Array.isArray(shop.gallery) && shop.gallery.length
    ? shop.gallery
    : [{ src: shop.image, alt: `${shop.name} ${fallbackAltSuffix}` }];
%>
<%- include('partials/head', { title: pageTitle, description: metaDescription, seoKeywords }) %>
  <section class="detail-hero">
    <div class="container detail-hero__grid">
      <div
        class="detail-gallery"
        data-slider
        data-dot-label="<%= t.shop && t.shop.gallery ? t.shop.gallery.dotLabel : 'View image {{index}}' %>"
      >
        <div class="detail-gallery__track" data-slider-track>
          <% galleryImages.forEach(function(image) {
               const source = typeof image === 'string' ? image : image.src;
               const altText = typeof image === 'string'
                 ? `${shop.name} ${fallbackAltSuffix}`
                 : (image.alt || `${shop.name} ${fallbackAltSuffix}`);
          %>
            <figure class="detail-gallery__slide">
              <img src="<%= source %>" alt="<%= altText %>" />
            </figure>
          <% }) %>
        </div>
        <% if (galleryImages.length > 1) { %>
          <button
            class="detail-gallery__control detail-gallery__control--prev"
            type="button"
            aria-label="<%= t.shop && t.shop.gallery ? t.shop.gallery.prev : 'Previous image' %>"
            data-slider-prev
          ></button>
          <button
            class="detail-gallery__control detail-gallery__control--next"
            type="button"
            aria-label="<%= t.shop && t.shop.gallery ? t.shop.gallery.next : 'Next image' %>"
            data-slider-next
          ></button>
          <div class="detail-gallery__dots" data-slider-dots></div>
        <% } %>
      </div>
      <div class="detail-hero__info">
        <p class="detail-hero__meta"><%= shop.region %> · <%= shop.district %> · <%= shop.category %></p>
        <h1><%= shop.name %></h1>
        <p class="detail-hero__description"><%= shop.description %></p>
        <dl class="detail-hero__list">
          <div>
            <dt><%= t.shop && t.shop.address ? t.shop.address : 'Address' %></dt>
            <dd><%= shop.address %></dd>
          </div>
          <div>
            <dt><%= t.shop && t.shop.phone ? t.shop.phone : 'Phone' %></dt>
            <dd><a href="tel:<%= shop.phone %>"><%= shop.phone %></a></dd>
          </div>
          <div>
            <dt><%= t.shop && t.shop.manager ? t.shop.manager : 'Manager' %></dt>
            <dd>
              <strong><%= shop.manager.name %></strong>
              <span class="detail-hero__manager-contact">
                <a href="tel:<%= shop.manager.phone %>"><%= shop.manager.phone %></a>
                <% if (shop.manager.kakao) { %>
                  · <%= t.shop && t.shop.contact ? t.shop.contact.kakao : 'KakaoTalk' %> <%= shop.manager.kakao %>
                <% } %>
              </span>
            </dd>
          </div>
          <div>
            <dt><%= t.shop && t.shop.hours ? t.shop.hours : 'Hours' %></dt>
            <dd><%= shop.hours %></dd>
          </div>
        </dl>
        <div class="detail-hero__actions">
          <a class="btn btn--primary" href="tel:<%= shop.manager.phone %>"><%= t.shop && t.shop.call ? t.shop.call : 'Call now' %></a>
          <a class="back-link" href="/"><%= t.shop && t.shop.back ? t.shop.back : 'Back to home' %></a>
        </div>
      </div>
    </div>
  </section>

  <section class="section detail-section">
    <div class="container detail-section__grid">
      <div class="detail-card">
        <h2><%= t.shop && t.shop.pricing ? t.shop.pricing.title : 'Pricing' %></h2>
        <div class="pricing-grid">
          <div class="pricing-card">
            <h3><%= t.shop && t.shop.pricing ? t.shop.pricing.base : 'Table' %></h3>
            <p><%= shop.pricing.base %></p>
          </div>
          <div class="pricing-card">
            <h3><%= t.shop && t.shop.pricing ? t.shop.pricing.tc : 'TC' %></h3>
            <p><%= shop.pricing.tc %></p>
          </div>
          <div class="pricing-card">
            <h3><%= t.shop && t.shop.pricing ? t.shop.pricing.rt : 'RT' %></h3>
            <p><%= shop.pricing.rt %></p>
          </div>
        </div>
      </div>
      <div class="detail-card">
        <h2><%= t.shop && t.shop.contact ? t.shop.contact.title : 'Concierge contact' %></h2>
        <div class="contact-card">
          <p><%= t.shop && t.shop.managerContact ? t.shop.managerContact : '' %></p>
          <ul>
            <li><strong><%= t.shop && t.shop.contact ? t.shop.contact.manager : 'Manager' %></strong> <%= shop.manager.name %></li>
            <li>
              <strong><%= t.shop && t.shop.contact ? t.shop.contact.phone : 'Phone' %></strong>
              <a href="tel:<%= shop.manager.phone %>"><%= shop.manager.phone %></a>
            </li>
            <% if (shop.manager.kakao) { %>
              <li><strong><%= t.shop && t.shop.contact ? t.shop.contact.kakao : 'KakaoTalk' %></strong> <%= shop.manager.kakao %></li>
            <% } %>
          </ul>
        </div>
      </div>
      <div class="detail-card">
        <h2><%= t.shop && t.shop.highlights ? t.shop.highlights : 'Highlights' %></h2>
        <ul class="detail-tags">
          <% shop.highlights.forEach(function(item) { %>
            <li><%= item %></li>
          <% }) %>
        </ul>
      </div>
    </div>
  </section>

  <section class="section section--muted detail-seo">
    <div class="container detail-seo__grid">
      <div>
        <h2><%= t.shop && t.shop.seo ? t.shop.seo.title : 'SEO keywords' %></h2>
        <p class="detail-seo__description"><%= t.shop && t.shop.seo ? t.shop.seo.description : '' %></p>
        <ul class="seo-chip-list">
          <% (seoKeywords || []).forEach(function(keyword) { %>
            <li><%= keyword %></li>
          <% }) %>
        </ul>
      </div>
      <form
        class="seo-editor"
        data-seo-editor
        data-success-message="<%= t.shop && t.shop.seo ? t.shop.seo.copySuccess : '' %>"
        data-error-message="<%= t.shop && t.shop.seo ? t.shop.seo.copyError : '' %>"
      >
        <label for="seo-keywords-input"><%= t.shop && t.shop.seo ? t.shop.seo.editorLabel : 'Keywords' %></label>
        <textarea id="seo-keywords-input" rows="6"><%= (seoKeywords || []).join(', ') %></textarea>
        <div class="seo-editor__actions">
          <button type="button" class="btn btn--ghost" data-action="copy"><%= t.shop && t.shop.seo ? t.shop.seo.copy : 'Copy' %></button>
          <span class="seo-editor__status" data-status role="status" aria-live="polite"></span>
        </div>
      </form>
    </div>
  </section>

  <div class="seo-keywords" aria-hidden="true">
    <%- (seoKeywords || []).join(', ') %>
  </div>
<%- include('partials/footer', { scripts: ['/scripts/shop-detail.js'] }) %>
