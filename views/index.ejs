<%- include('partials/head', {
  title: pageTitle,
  description: metaDescription,
  seoKeywords,
  extraStyles: ['https://unpkg.com/leaflet@1.9.4/dist/leaflet.css']
}) %>
  <section class="section" id="map-overview">
    <div class="container">
      <div class="section__header">
        <div>
          <h2 class="section__title"><%= (t.mapOverview && t.mapOverview.title) || '' %></h2>
          <p class="section__subtitle"><%= (t.mapOverview && t.mapOverview.subtitle) || '' %></p>
        </div>
      </div>
      <div
        class="shop-map"
        data-shops-map
        data-map-locale="<%= lang || 'ko' %>"
        data-loading-text="<%= (t.mapOverview && t.mapOverview.loading) || 'Loading map…' %>"
        data-error-text="<%= (t.mapOverview && t.mapOverview.error) || 'Unable to load map. Please check the address.' %>"
        data-link-label="<%= (t.mapOverview && t.mapOverview.linkLabel) || t.shop && t.shop.viewDetails || 'View details' %>"
      >
        <div
          class="shop-map__map"
          data-map-region
          role="img"
          aria-label="<%= (t.mapOverview && t.mapOverview.ariaLabel) || 'Map showing partner locations' %>"
        ></div>
        <p class="shop-map__status" data-map-status aria-live="polite">
          <%= (t.mapOverview && t.mapOverview.loading) || 'Loading map…' %>
        </p>
      </div>
    </div>
  </section>
  <section class="section" id="areas">
    <div class="container">
      <div class="section__header">
        <div>
          <h2 class="section__title"><%= t.areas && t.areas.title ? t.areas.title : '' %></h2>
          <p class="section__subtitle"><%= t.areas && t.areas.subtitle ? t.areas.subtitle : '' %></p>
        </div>
      </div>
      <div class="shop-grid" data-grid>
        <% shops.forEach(function(shop) { %>
          <article
            class="shop-card"
            data-region="<%= shop.region %>"
            data-district="<%= shop.district %>"
            data-category="<%= shop.category %>"
            data-area-group="<%= shop.areaGroup %>"
          >
            <div class="shop-card__image">
              <% if (shop.image) { %>
                <img src="<%= shop.image %>" alt="<%= shop.imageAlt || shop.name %>" />
              <% } %>
            </div>
            <div class="shop-card__body">
              <span class="shop-card__meta"><%= shop.region %> · <%= shop.district %> · <%= shop.category %></span>
              <h3><%= shop.name %></h3>
              <a class="shop-card__link" href="/shops/<%= shop.id %>"><%= t.shop && t.shop.viewDetails ? t.shop.viewDetails : '' %></a>
            </div>
          </article>
        <% }) %>
      </div>
    </div>
  </section>

  <script id="region-district-data" type="application/json">
    <%- JSON.stringify(districtMap) %>
  </script>
  <script id="shop-map-data" type="application/json">
    <%- JSON.stringify(shops.map(function (shop) {
      return {
        id: shop.id,
        name: shop.name,
        address: shop.address,
        district: shop.district,
        region: shop.region,
        category: shop.category,
        url: `/shops/${encodeURIComponent(shop.id)}`
      };
    })) %>
  </script>
  <div class="seo-keywords" aria-hidden="true">
    <%- seoKeywords.join(', ') %>
  </div>
<%- include('partials/footer', {
  scripts: [
    'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js',
    '/scripts/index-map.js'
  ]
}) %>
