# Nginx example: block untrusted origins and require Authorization on protected JSON routes
location ~* ^/shops/.+/entries\.json$ {
    if ($http_authorization = "") {
        return 403;
    }
    if ($http_origin !~* "^(https?://(localhost(:[0-9]+)?|trusted-example\.com))$") {
        return 403;
    }
    add_header Access-Control-Allow-Origin $http_origin always;
    add_header Vary Origin;
    add_header Access-Control-Allow-Credentials true;
    add_header Access-Control-Allow-Headers "Authorization,Content-Type,Accept,X-Requested-With";
    add_header Access-Control-Allow-Methods "GET,POST,PUT,PATCH,DELETE,OPTIONS";
}

# Apache example using mod_rewrite
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{REQUEST_URI} ^/shops/.+/entries\.json$ [NC]
  RewriteCond %{HTTP:Authorization} ^Bearer\s.+ [NC]
  RewriteCond %{HTTP:Origin} ^https?://(localhost(:[0-9]+)?|trusted-example\.com)$ [NC]
  RewriteRule ^ - [E=ALLOW_ENTRY:1]
  RewriteCond %{ENV:ALLOW_ENTRY} !=1
  RewriteRule ^ - [F]
</IfModule>
